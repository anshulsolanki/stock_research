<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Technical Analysis</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
    <div class="container">
        <header>
            <h1>üìà Stock Technical Analysis</h1>
            <p class="subtitle">MACD, Supertrend & Bollinger Bands Analysis</p>
        </header>

        <div class="search-section">
            <div class="search-box">
                <input type="text" id="tickerInput" placeholder="Enter stock ticker (e.g., AAPL, MARICO.NS)"
                    autofocus />
                <button id="analyzeBtn" onclick="analyzeStock()">
                    <span class="btn-text">Analyze</span>
                    <span class="loader" style="display: none;"></span>
                </button>
            </div>
            <p class="hint">üí° Tip: Use Yahoo Finance tickers (e.g., RELIANCE.NS for NSE stocks)</p>
        </div>

        <div id="results" class="results-container" style="display: none;">
            <div class="results-header">
                <h2 id="tickerName"></h2>
                <span id="timestamp" class="timestamp"></span>
            </div>

            <!-- Main Tabs -->
            <div class="main-tabs">
                <button class="main-tab-button active" onclick="showMainTab('lagging')">Lagging Indicator
                    Analysis</button>
                <button class="main-tab-button" onclick="showMainTab('leading')">Leading Indicator Analysis</button>
            </div>


            <!-- Lagging Indicator Analysis Tab -->
            <div id="lagging-section" class="main-tab-content active">
                <div class="tabs">
                    <button class="tab-button active" onclick="showTab('macd')">MACD Analysis</button>
                    <button class="tab-button" onclick="showTab('supertrend')">Supertrend Analysis</button>
                    <button class="tab-button" onclick="showTab('bollinger')">Bollinger Bands</button>
                    <button class="tab-button" onclick="showTab('crossover')">Crossover Analysis</button>
                    <button class="tab-button" onclick="showTab('donchian')">Donchian Channels</button>
                </div>

                <!-- MACD Tab Content -->
                <div id="macd-tab" class="tab-content active">
                    <!-- MACD Configuration -->
                    <div class="tab-config-section">
                        <button class="config-toggle" onclick="toggleConfig('macdConfigPanel')">‚öôÔ∏è MACD
                            Configuration</button>
                        <div id="macdConfigPanel" class="config-panel" style="display: none;">
                            <div class="config-group">
                                <div class="input-group">
                                    <label for="macdFast">Fast Period:</label>
                                    <input type="number" id="macdFast" value="12" min="1">
                                </div>
                                <div class="input-group">
                                    <label for="macdSlow">Slow Period:</label>
                                    <input type="number" id="macdSlow" value="26" min="1">
                                </div>
                                <div class="input-group">
                                    <label for="macdSignal">Signal Period:</label>
                                    <input type="number" id="macdSignal" value="9" min="1">
                                </div>
                                <div class="input-group">
                                    <label for="macdInterval">Interval:</label>
                                    <select id="macdInterval">
                                        <option value="1d" selected>1 Day</option>
                                        <option value="1wk">1 Week</option>
                                        <option value="1mo">1 Month</option>
                                        <option value="1h">1 Hour</option>
                                        <option value="15m">15 Min</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label for="macdLookback">Lookback (Days):</label>
                                    <input type="number" id="macdLookback" value="730" min="1">
                                </div>
                                <button class="run-analysis-btn" onclick="analyzeStock('macd')">Run MACD
                                    Analysis</button>
                            </div>
                        </div>
                    </div>

                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-label">MACD Line</div>
                            <div class="metric-value" id="macdLine">--</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Signal Line</div>
                            <div class="metric-value" id="signalLine">--</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Histogram</div>
                            <div class="metric-value" id="histogram">--</div>
                        </div>
                        <div class="metric-card trend-card" id="trendCard">
                            <div class="metric-label">Trend</div>
                            <div class="metric-value" id="trend">--</div>
                        </div>
                        <div class="metric-card momentum-card" id="momentumCard">
                            <div class="metric-label">Momentum</div>
                            <div class="metric-value" id="momentum">--</div>
                        </div>
                        <div class="metric-card signal-card" id="crossoverCard">
                            <div class="metric-label">Signal</div>
                            <div class="metric-value signal-value" id="crossoverSignal">--</div>
                        </div>
                    </div>

                    <div id="divergenceSection" class="divergence-section" style="display: none;">
                        <h3>‚ö†Ô∏è Divergences Detected</h3>
                        <div id="divergenceList" class="divergence-list"></div>
                    </div>

                    <div class="chart-section">
                        <h3>MACD Chart</h3>
                        <img id="macdChartImage" src="" alt="MACD Chart" />
                    </div>
                </div>

                <!-- Supertrend Tab Content -->
                <div id="supertrend-tab" class="tab-content">
                    <!-- Supertrend Configuration -->
                    <div class="tab-config-section">
                        <button class="config-toggle" onclick="toggleConfig('stConfigPanel')">‚öôÔ∏è Supertrend
                            Configuration</button>
                        <div id="stConfigPanel" class="config-panel" style="display: none;">
                            <div class="config-group">
                                <div class="input-group">
                                    <label for="stPeriod">ATR Period:</label>
                                    <input type="number" id="stPeriod" value="14" min="1">
                                </div>
                                <div class="input-group">
                                    <label for="stMultiplier">Multiplier:</label>
                                    <input type="number" id="stMultiplier" value="3.0" step="0.1" min="0.1">
                                </div>
                                <div class="input-group">
                                    <label for="stInterval">Interval:</label>
                                    <select id="stInterval">
                                        <option value="1d" selected>1 Day</option>
                                        <option value="1wk">1 Week</option>
                                        <option value="1mo">1 Month</option>
                                        <option value="1h">1 Hour</option>
                                        <option value="15m">15 Min</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label for="stLookback">Lookback (Days):</label>
                                    <input type="number" id="stLookback" value="730" min="1">
                                </div>
                                <button class="run-analysis-btn" onclick="analyzeStock('supertrend')">Run Supertrend
                                    Analysis</button>
                            </div>
                        </div>
                    </div>

                    <div class="metrics-grid">
                        <div class="metric-card supertrend-status-card" id="supertrendStatusCard">
                            <div class="metric-label">Status</div>
                            <div class="metric-value" id="supertrendStatus">--</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Last Price</div>
                            <div class="metric-value" id="supertrendPrice">--</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Supertrend Value</div>
                            <div class="metric-value" id="supertrendValue">--</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Last Date</div>
                            <div class="metric-value" id="supertrendDate">--</div>
                        </div>
                    </div>

                    <div class="chart-section">
                        <h3>Supertrend Chart</h3>
                        <img id="supertrendChartImage" src="" alt="Supertrend Chart" />
                    </div>
                </div>

                <!-- Bollinger Band Tab Content -->
                <div id="bollinger-tab" class="tab-content">
                    <!-- Bollinger Configuration -->
                    <div class="tab-config-section">
                        <button class="config-toggle" onclick="toggleConfig('bbConfigPanel')">‚öôÔ∏è Bollinger Band
                            Configuration</button>
                        <div id="bbConfigPanel" class="config-panel" style="display: none;">
                            <div class="config-group">
                                <div class="input-group">
                                    <label for="bbWindow">Window:</label>
                                    <input type="number" id="bbWindow" value="20" min="1">
                                </div>
                                <div class="input-group">
                                    <label for="bbNumStd">Std Dev:</label>
                                    <input type="number" id="bbNumStd" value="2" step="0.1" min="0.1">
                                </div>
                                <div class="input-group">
                                    <label for="bbInterval">Interval:</label>
                                    <select id="bbInterval">
                                        <option value="1d" selected>1 Day</option>
                                        <option value="1wk">1 Week</option>
                                        <option value="1mo">1 Month</option>
                                        <option value="1h">1 Hour</option>
                                        <option value="15m">15 Min</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label for="bbLookback">Lookback (Days):</label>
                                    <input type="number" id="bbLookback" value="730" min="1">
                                </div>
                                <button class="run-analysis-btn" onclick="analyzeStock('bollinger')">Run Bollinger
                                    Analysis</button>
                            </div>
                        </div>
                    </div>

                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-label">Upper Band</div>
                            <div class="metric-value" id="bbUpper">--</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Lower Band</div>
                            <div class="metric-value" id="bbLower">--</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Middle Band</div>
                            <div class="metric-value" id="bbMiddle">--</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">%B</div>
                            <div class="metric-value" id="bbPctB">--</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">BandWidth</div>
                            <div class="metric-value" id="bbBandWidth">--</div>
                        </div>
                        <div class="metric-card" id="bbStatusCard">
                            <div class="metric-label">Status</div>
                            <div class="metric-value" id="bbStatus">--</div>
                        </div>
                    </div>

                    <div id="bbSignalSection" class="divergence-section" style="display: none;">
                        <h3>üì¢ Recent Signals</h3>
                        <div id="bbSignalList" class="divergence-list"></div>
                    </div>

                    <div class="chart-section">
                        <h3>Bollinger Bands Chart</h3>
                        <img id="bollingerChartImage" src="" alt="Bollinger Bands Chart" />
                    </div>
                </div>

                <!-- Crossover Tab Content -->
                <div id="crossover-tab" class="tab-content">
                    <!-- Crossover Configuration -->
                    <div class="tab-config-section">
                        <button class="config-toggle" onclick="toggleConfig('crossConfigPanel')">‚öôÔ∏è Crossover
                            Configuration</button>
                        <div id="crossConfigPanel" class="config-panel" style="display: none;">
                            <div class="config-group">
                                <div class="input-group">
                                    <label for="crossShort">Short Window:</label>
                                    <input type="number" id="crossShort" value="20" min="1">
                                </div>
                                <div class="input-group">
                                    <label for="crossMedium">Medium Window:</label>
                                    <input type="number" id="crossMedium" value="50" min="1">
                                </div>
                                <div class="input-group">
                                    <label for="crossLong">Long Window:</label>
                                    <input type="number" id="crossLong" value="200" min="1">
                                </div>
                                <div class="input-group">
                                    <label for="crossInterval">Interval:</label>
                                    <select id="crossInterval">
                                        <option value="1d" selected>1 Day</option>
                                        <option value="1wk">1 Week</option>
                                        <option value="1mo">1 Month</option>
                                        <option value="1h">1 Hour</option>
                                        <option value="15m">15 Min</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label for="crossLookback">Lookback (Days):</label>
                                    <input type="number" id="crossLookback" value="730" min="1">
                                </div>
                                <button class="run-analysis-btn" onclick="analyzeStock('crossover')">Run Crossover
                                    Analysis</button>
                            </div>
                        </div>
                    </div>

                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-label">EMA 20</div>
                            <div class="metric-value" id="ema20">--</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">EMA 50</div>
                            <div class="metric-value" id="ema50">--</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">EMA 200</div>
                            <div class="metric-value" id="ema200">--</div>
                        </div>
                        <div class="metric-card trend-card" id="crossoverTrendCard">
                            <div class="metric-label">Trend Status</div>
                            <div class="metric-value" id="crossoverTrend">--</div>
                        </div>
                    </div>

                    <div id="goldenCrossSection" class="divergence-section" style="display: none;">
                        <h3>üåü Golden Cross Detected</h3>
                        <div id="goldenCrossInfo" class="divergence-list"></div>
                    </div>

                    <div class="chart-section">
                        <h3>EMA Crossover Chart</h3>
                        <img id="crossoverChartImage" src="" alt="Crossover Chart" />
                    </div>
                </div>

                <!-- Donchian Channel Tab Content -->
                <div id="donchian-tab" class="tab-content">
                    <!-- Donchian Configuration -->
                    <div class="tab-config-section">
                        <button class="config-toggle" onclick="toggleConfig('donchianConfigPanel')">‚öôÔ∏è Donchian
                            Channel
                            Configuration</button>
                        <div id="donchianConfigPanel" class="config-panel" style="display: none;">
                            <div class="config-group">
                                <div class="input-group">
                                    <label for="donchianWindow">Window:</label>
                                    <input type="number" id="donchianWindow" value="20" min="1">
                                </div>
                                <div class="input-group">
                                    <label for="donchianInterval">Interval:</label>
                                    <select id="donchianInterval">
                                        <option value="1d" selected>1 Day</option>
                                        <option value="1wk">1 Week</option>
                                        <option value="1mo">1 Month</option>
                                        <option value="1h">1 Hour</option>
                                        <option value="15m">15 Min</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label for="donchianLookback">Lookback (Days):</label>
                                    <input type="number" id="donchianLookback" value="730" min="1">
                                </div>
                                <button class="run-analysis-btn" onclick="analyzeStock('donchian')">Run Donchian
                                    Analysis</button>
                            </div>
                        </div>
                    </div>

                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-label">Upper Channel</div>
                            <div class="metric-value" id="donchianUpper">--</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Lower Channel</div>
                            <div class="metric-value" id="donchianLower">--</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Middle Channel</div>
                            <div class="metric-value" id="donchianMiddle">--</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Last Price</div>
                            <div class="metric-value" id="donchianPrice">--</div>
                        </div>
                        <div class="metric-card" id="donchianStatusCard">
                            <div class="metric-label">Status</div>
                            <div class="metric-value" id="donchianStatus">--</div>
                        </div>
                        <div class="metric-card signal-card" id="donchianSignalCard">
                            <div class="metric-label">Signal</div>
                            <div class="metric-value signal-value" id="donchianSignal">--</div>
                        </div>
                    </div>

                    <div id="donchianSignalSection" class="divergence-section" style="display: none;">
                        <h3>üì¢ Recent Breakouts</h3>
                        <div id="donchianSignalList" class="divergence-list"></div>
                    </div>

                    <div class="chart-section">
                        <h3>Donchian Channels Chart</h3>
                        <img id="donchianChartImage" src="" alt="Donchian Channels Chart" />
                    </div>
                </div>
            </div>

            <!-- Leading Indicator Analysis Tab -->
            <div id="leading-section" class="main-tab-content">
                <div class="tabs">
                    <button class="tab-button active" onclick="showTab('rsi')">RSI Divergence</button>
                </div>

                <!-- RSI Divergence Tab Content -->
                <div id="rsi-tab" class="tab-content active">
                    <!-- RSI Configuration -->
                    <div class="tab-config-section">
                        <button class="config-toggle" onclick="toggleConfig('rsiConfigPanel')">‚öôÔ∏è RSI
                            Configuration</button>
                        <div id="rsiConfigPanel" class="config-panel" style="display: none;">
                            <div class="config-group">
                                <div class="input-group">
                                    <label for="rsiPeriod">RSI Period:</label>
                                    <input type="number" id="rsiPeriod" value="14" min="1">
                                </div>
                                <div class="input-group">
                                    <label for="rsiOrder">Peak/Trough Order:</label>
                                    <input type="number" id="rsiOrder" value="5" min="1">
                                </div>
                                <div class="input-group">
                                    <label for="rsiInterval">Interval:</label>
                                    <select id="rsiInterval">
                                        <option value="1d" selected>1 Day</option>
                                        <option value="1wk">1 Week</option>
                                        <option value="1mo">1 Month</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label for="rsiLookback">Lookback (Days):</label>
                                    <input type="number" id="rsiLookback" value="730" min="1">
                                </div>
                                <div class="input-group">
                                    <label for="rsiOverbought">Overbought:</label>
                                    <input type="number" id="rsiOverbought" value="70" min="1" max="100">
                                </div>
                                <div class="input-group">
                                    <label for="rsiOversold">Oversold:</label>
                                    <input type="number" id="rsiOversold" value="30" min="1" max="100">
                                </div>
                                <button class="run-analysis-btn" onclick="analyzeStock('rsi')">Run RSI
                                    Analysis</button>
                            </div>
                        </div>
                    </div>

                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-label">Current RSI</div>
                            <div class="metric-value" id="rsiCurrent">--</div>
                        </div>
                    </div>

                    <div id="rsiDivergenceSection" class="divergence-section" style="display: none;">
                        <h3>‚ö†Ô∏è Divergences Detected</h3>
                        <div id="rsiDivergenceList" class="divergence-list"></div>
                    </div>

                    <div class="chart-section">
                        <h3>RSI Divergence Chart</h3>
                        <img id="rsiChartImage" src="" alt="RSI Divergence Chart" />
                    </div>
                </div>
            </div>
        </div>

        <div id="error" class="error-message" style="display: none;"></div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}?v=2"></script>
</body>

</html>